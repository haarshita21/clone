<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chyrp - Share Your Moments</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Your existing CSS remains unchanged */
        *{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',Roboto,sans-serif}
        :root{--primary:#6A0DAD;--secondary:#FF6B6B;--accent:#4ECDC4;--background:#F8F9FA;--card-bg:#FFFFFF;--text:#2D3436;--text-light:#636E72;--border:#DFE6E9;--shadow:rgba(0,0,0,0.08)}
        body{background-color:var(--background);color:var(--text);line-height:1.4;padding:0;margin:0}
        .container{max-width:1200px;margin:0 auto;padding:0 20px}
        header{background-color:var(--card-bg);border-bottom:1px solid var(--border);position:fixed;top:0;width:100%;z-index:100;box-shadow:0 2px 10px var(--shadow)}
        .header-content{display:flex;justify-content:space-between;align-items:center;height:70px;padding:0 20px}
        .logo{font-size:2rem;font-weight:800;color:var(--primary);text-decoration:none;display:flex;align-items:center}
        .logo i{margin-right:10px;color:var(--secondary)}
        .search-box{background:#efefef;border-radius:20px;padding:10px 20px;width:300px;display:flex;align-items:center}
        .search-box input{background:transparent;border:none;outline:none;margin-left:10px;width:100%;font-size:1rem}
        .nav-icons{display:flex;gap:25px;align-items:center}
        .nav-icons a{color:var(--text);font-size:1.4rem;position:relative}
        .user-actions{display:flex;gap:15px;align-items:center}
        .btn{padding:10px 20px;border-radius:20px;border:none;font-weight:600;cursor:pointer;transition:all 0.2s}
        .btn-primary{background:var(--primary);color:white}
        .btn-primary:hover{background:#5a0a9a}
        .btn-outline{background:transparent;border:2px solid var(--primary);color:var(--primary)}
        .btn-outline:hover{background:var(--primary);color:white}
        .theme-selector{display:flex;gap:10px;margin-left:20px}
        .theme-btn{width:24px;height:24px;border-radius:50%;border:2px solid white;cursor:pointer;box-shadow:0 0 5px rgba(0,0,0,0.2)}
        .theme-btn.active{transform:scale(1.3);box-shadow:0 0 8px rgba(0,0,0,0.5)}
        .theme-default{background:linear-gradient(45deg,#6A0DAD,#FF6B6B,#4ECDC4)}
        .theme-coral{background:linear-gradient(45deg,#FF7F50,#FFD700,#FF6347)}
        .theme-night{background:linear-gradient(45deg,#000000,#003300,#001100)}
        .theme-blossom{background:linear-gradient(45deg,#FFB6C1,#FFDAB9,#DDA0DD)}
        .main-content{display:flex;margin-top:90px;gap:30px}
        .feed{flex:2}
        .welcome-card{background:var(--card-bg);border-radius:10px;padding:30px;margin-bottom:30px;box-shadow:0 5px 15px var(--shadow);text-align:center}
        .welcome-card h2{color:var(--primary);margin-bottom:15px}
        .welcome-card p{color:var(--text-light);margin-bottom:20px}
        .post-options{display:flex;gap:15px;justify-content:center}
        .post-option-btn{display:flex;flex-direction:column;align-items:center;padding:20px;background:var(--card-bg);border:2px solid var(--border);border-radius:10px;cursor:pointer;transition:all 0.2s;width:120px}
        .post-option-btn:hover{transform:translateY(-5px);box-shadow:0 5px 15px var(--shadow);border-color:var(--primary)}
        .post-option-btn i{font-size:2rem;margin-bottom:10px;color:var(--primary)}
        .sidebar{flex:1;position:sticky;top:90px;height:fit-content}
        .profile-card{background:var(--card-bg);border-radius:10px;padding:20px;margin-bottom:30px;box-shadow:0 5px 15px var(--shadow);text-align:center}
        .profile-card-avatar{width:80px;height:80px;border-radius:50%;overflow:hidden;margin:0 auto 15px;border:3px solid var(--primary);display:flex;align-items:center;justify-content:center;background:var(--accent);color:white;font-size:2rem;cursor:pointer}
        .profile-card-username{font-weight:700;font-size:1.2rem;margin-bottom:5px}
        .profile-card-name{color:var(--text-light);margin-bottom:15px}
        .stats{display:flex;justify-content:space-around;margin:20px 0}
        .stat{text-align:center}
        .stat-value{font-weight:700;font-size:1.2rem;color:var(--primary)}
        .stat-label{font-size:0.9rem;color:var(--text-light)}
        .modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);z-index:1000;justify-content:center;align-items:center}
        .modal-content{background:var(--card-bg);border-radius:10px;width:600px;max-width:90%;max-height:90vh;overflow-y:auto}
        .modal-header{padding:20px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center}
        .modal-header h3{color:var(--primary)}
        .modal-close{background:none;border:none;font-size:1.5rem;cursor:pointer;color:var(--text-light)}
        .modal-body{padding:20px}
        .post-type-selector{display:flex;gap:10px;margin-bottom:20px}
        .post-type-btn{flex:1;padding:15px;background:var(--card-bg);border:2px solid var(--border);border-radius:8px;cursor:pointer;text-align:center;font-weight:600}
        .post-type-btn.active{border-color:var(--primary);background:var(--primary);color:white}
        .post-form .form-group,.profile-edit-form .form-group{margin-bottom:20px}
        .post-form label,.profile-edit-form label{display:block;margin-bottom:8px;font-weight:600}
        .post-form input,.post-form textarea,.post-form select,.profile-edit-form input,.profile-edit-form textarea{width:100%;padding:12px 15px;border:2px solid var(--border);border-radius:8px;font-size:1rem}
        .post-form textarea{min-height:150px;resize:vertical}
        .profile-edit-form textarea{min-height:100px;resize:vertical}
        .file-upload{border:2px dashed var(--border);border-radius:8px;padding:30px;text-align:center;cursor:pointer;position:relative}
        .file-upload i{font-size:3rem;color:var(--text-light);margin-bottom:15px}
        .file-upload img{max-width:100%;max-height:200px;margin-top:15px;display:none}
        .modal-footer{padding:20px;border-top:1px solid var(--border);text-align:right}
        .avatar-preview{width:100px;height:100px;border-radius:50%;overflow:hidden;margin:0 auto 15px;border:3px solid var(--primary);display:flex;align-items:center;justify-content:center;background:var(--accent);color:white;font-size:2.5rem}
        .avatar-preview img{width:100%;height:100%;object-fit:cover}
        .profile-pic-upload{text-align:center;margin-bottom:20px}
        .profile-container,.chat-container{display:none;margin-top:90px;padding:20px}
        .profile-header,.chat-header{display:flex;align-items:center;margin-bottom:30px}
        .profile-back-btn,.chat-back-btn{background:none;border:none;font-size:1.5rem;margin-right:15px;cursor:pointer;color:var(--primary)}
        .profile-info{display:flex;align-items:center;gap:30px;margin-bottom:30px}
        .profile-avatar-large{width:150px;height:150px;border-radius:50%;overflow:hidden;border:5px solid var(--primary);display:flex;align-items:center;justify-content:center;background:var(--accent);color:white;font-size:4rem}
        .profile-avatar-large img{width:100%;height:100%;object-fit:cover}
        .profile-details h2{font-size:2rem;margin-bottom:5px}
        .profile-details h3{color:var(--text-light);margin-bottom:15px}
        .profile-details p{margin-bottom:15px;line-height:1.6}
        .profile-posts{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:20px}
        .profile-post{background:var(--card-bg);border-radius:10px;overflow:hidden;box-shadow:0 5px 15px var(--shadow)}
        .profile-post img{width:100%;height:250px;object-fit:cover}
        .profile-post-content{padding:15px}
        .profile-post-title{font-weight:600;margin-bottom:10px;color:var(--primary)}
        .profile-post-text{color:var(--text-light);margin-bottom:10px;display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden}
        .profile-post-date{font-size:0.8rem;color:var(--text-light)}
        body.theme-coral{--primary:#FF7F50;--secondary:#FF6347;--accent:#FFD700;--background:#FFF5EE;--card-bg:#FFFFFF;--text:#2D3436;--text-light:#636E72;--border:#FFE4B5;--shadow:rgba(255,127,80,0.2)}
        body.theme-night{--primary:#00FF00;--secondary:#00CC00;--accent:#00AA00;--background:#000000;--card-bg:#111111;--text:#00FF00;--text-light:#00CC00;--border:#003300;--shadow:rgba(0,255,0,0.2)}
        body.theme-night .card,body.theme-night .profile-card,body.theme-night .post,body.theme-night .modal-content,body.theme-night .welcome-card{box-shadow:0 0 15px rgba(0,255,0,0.3),0 0 30px rgba(0,255,0,0.1)}
        body.theme-blossom{--primary:#DDA0DD;--secondary:#FFB6C1;--accent:#FFDAB9;--background:#FFF0F5;--card-bg:#FFFFFF;--text:#8B4513;--text-light:#A0522D;--border:#FFE4E1;--shadow:rgba(221,160,221,0.3)}
        body.theme-blossom::after{content:"";position:fixed;top:0;left:0;width:100%;height:100%;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'%3E%3Cpath fill='%23FFB6C1' fill-opacity='0.1' d='M50,30c5.5,0,10,4.5,10,10c0,5.5-4.5,10-10,10c-5.5,0-10-4.5-10-10C40,34.5,44.5,30,50,30z M50,15 c3.3,0,6,2.7,6,6s-2.7,6-6,6s-6-2.7-6-6S46.7,15,50,15z M50,65c3.3,0,6,2.7,6,6s-2.7,6-6,6s-6-2.7-6-6S46.7,65,50,65z M15,50 c0,3.3,2.7,6,6,6s6-2.7,6-6s-2.7-6-6-6S15,46.7,15,50z M65,50c0,3.3,2.7,6,6,6s6-2.7,6-6s-2.7-6-6-6S65,46.7,65,50z'%3E%3C/path%3E%3C/svg%3E");pointer-events:none;z-index:-1}
        .auth-container{display:flex;justify-content:center;align-items:center;height:100vh;background:linear-gradient(135deg,var(--primary)0%,var(--accent)100%)}
        .auth-box{background:white;border-radius:10px;box-shadow:0 10px 30px rgba(0,0,0,0.1);width:400px;padding:30px}
        .auth-header{text-align:center;margin-bottom:30px}
        .auth-header h2{color:var(--primary);margin-bottom:10px}
        .auth-form .form-group{margin-bottom:20px}
        .auth-form label{display:block;margin-bottom:8px;font-weight:600;color:var(--text)}
        .auth-form input{width:100%;padding:12px 15px;border:2px solid var(--border);border-radius:8px;font-size:1rem}
        .auth-form input:focus{border-color:var(--primary);outline:none}
        .auth-footer{text-align:center;margin-top:20px;color:var(--text-light)}
        .auth-footer a{color:var(--primary);text-decoration:none;font-weight:600}
        .post{background:var(--card-bg);border-radius:10px;padding:20px;margin-bottom:20px;box-shadow:0 5px 15px var(--shadow)}
        .post-header{display:flex;align-items:center;margin-bottom:15px}
        .post-avatar{width:40px;height:40px;border-radius:50%;background:var(--accent);display:flex;align-items:center;justify-content:center;color:white;font-size:1.2rem;margin-right:10px;cursor:pointer}
        .post-author{font-weight:600}
        .post-time{color:var(--text-light);font-size:0.8rem}
        .post-content{margin-bottom:15px}
        .post-title{font-size:1.4rem;margin-bottom:10px;color:var(--primary)}
        .post-text{line-height:1.6}
        .post-image{width:100%;border-radius:8px;margin:15px 0;max-height:400px;object-fit:cover}
        .post-actions{display:flex;gap:15px;border-top:1px solid var(--border);padding-top:15px}
        .post-action{display:flex;align-items:center;gap:5px;color:var(--text-light);cursor:pointer;transition:all 0.2s}
        .post-action:hover{color:var(--primary)}
        .post-action.active{color:var(--primary)}
        .post-action.active .fa-heart{color:var(--secondary)}
        .post-action.active .fa-bookmark{color:var(--accent)}
        .post-category{display:inline-block;background:var(--accent);color:white;padding:4px 10px;border-radius:12px;font-size:0.8rem;margin-bottom:10px}
        .chat-list{background:var(--card-bg);border-radius:10px;padding:20px;box-shadow:0 5px 15px var(--shadow)}
        .chat-item{display:flex;align-items:center;padding:15px;border-bottom:1px solid var(--border);cursor:pointer}
        .chat-item:last-child{border-bottom:none}
        .chat-item-avatar{width:50px;height:50px;border-radius:50%;background:var(--accent);display:flex;align-items:center;justify-content:center;color:white;font-size:1.5rem;margin-right:15px}
        .chat-item-info{flex:1}
        .chat-item-name{font-weight:600}
        .chat-item-preview{color:var(--text-light);font-size:0.9rem}
        .chat-item-time{color:var(--text-light);font-size:0.8rem}
        .chat-room-header{display:flex;align-items:center;margin-bottom:20px}
        .chat-room-back-btn{background:none;border:none;font-size:1.5rem;margin-right:15px;cursor:pointer;color:var(--primary)}
        .chat-messages{background:var(--card-bg);border-radius:10px;padding:20px;box-shadow:0 5px 15px var(--shadow);height:500px;overflow-y:auto;margin-bottom:20px}
        .message{margin-bottom:15px;display:flex;flex-direction:column}
        .message.sent{align-items:flex-end}
        .message.received{align-items:flex-start}
        .message-content{background:var(--primary);color:white;padding:10px 15px;border-radius:20px;max-width:70%}
        .message.received .message-content{background:var(--border);color:var(--text)}
        .message-time{font-size:0.8rem;color:var(--text-light);margin-top:5px}
        .chat-input{display:flex;gap:10px}
        .chat-input input{flex:1;padding:12px 15px;border:2px solid var(--border);border-radius:20px;font-size:1rem}
        .chat-input button{padding:12px 20px;border-radius:20px;border:none;background:var(--primary);color:white;cursor:pointer}
        .hidden{display:none}
        
        /* Left panel for saved/liked posts */
        .left-panel{width:250px;position:sticky;top:90px;height:calc(100vh - 100px);overflow-y:auto;padding-right:15px}
        .panel-card{background:var(--card-bg);border-radius:10px;padding:20px;margin-bottom:20px;box-shadow:0 5px 15px var(--shadow)}
        .panel-card h3{margin-bottom:15px;color:var(--primary)}
        .panel-item{display:flex;align-items:center;padding:10px;border-radius:8px;cursor:pointer;transition:all 0.2s;margin-bottom:5px}
        .panel-item:hover{background:var(--border)}
        .panel-item.active{background:var(--primary);color:white}
        .panel-item i{margin-right:10px;width:20px;text-align:center}
        
        /* Media queries for responsive design */
        @media (max-width: 992px) {
            .left-panel{display:none}
            .main-content{gap:20px}
        }
        @media (max-width: 768px) {
            .search-box{width:200px}
            .nav-icons{gap:15px}
            .post-options{flex-wrap:wrap}
        }
        @media (max-width: 576px) {
            .header-content{flex-direction:column;height:auto;padding:10px}
            .search-box{width:100%;margin:10px 0}
            .user-actions{width:100%;justify-content:space-between}
            .main-content{flex-direction:column}
            .sidebar{order:-1;margin-bottom:20px;position:static}
        }
    </style>
</head>
<body class="theme-default">
    <!-- Login Screen -->
    <div id="authScreen" class="auth-container">
        <div class="auth-box">
            <div class="auth-header">
                <div class="logo"><i class="fas fa-dove"></i>Chyrp</div>
                <h2>Welcome to Chyrp</h2>
                <p>Sign in to share your moments</p>
            </div>
            
            <form class="auth-form" id="loginForm">
                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" id="email" placeholder="Enter your email" required>
                </div>
                
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" placeholder="Enter your password" required>
                </div>
                
                <button type="submit" class="btn btn-primary" style="width: 100%">Sign In</button>
            </form>
            
            <div class="auth-footer">
                <p>Don't have an account? <a href="#" id="showRegister">Sign Up</a></p>
            </div>
        </div>
    </div>

    <!-- Register Screen -->
    <div id="registerScreen" class="auth-container hidden">
        <div class="auth-box">
            <div class="auth-header">
                <div class="logo"><i class="fas fa-dove"></i>Chyrp</div>
                <h2>Create an Account</h2>
                <p>Join the Chyrp community</p>
            </div>
            
            <form class="auth-form" id="registerForm">
                <div class="form-group">
                    <label for="reg-name">Full Name</label>
                    <input type="text" id="reg-name" placeholder="Enter your full name" required>
                </div>
                
                <div class="form-group">
                    <label for="reg-username">Username</label>
                    <input type="text" id="reg-username" placeholder="Choose a username" required>
                </div>
                
                <div class="form-group">
                    <label for="reg-email">Email</label>
                    <input type="email" id="reg-email" placeholder="Enter your email" required>
                </div>
                
                <div class="form-group">
                    <label for="reg-password">Password</label>
                    <input type="password" id="reg-password" placeholder="Create a password" required>
                </div>
                
                <button type="submit" class="btn btn-primary" style="width: 100%">Sign Up</button>
            </form>
            
            <div class="auth-footer">
                <p>Already have an account? <a href="#" id="showLogin">Sign In</a></p>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="appScreen" class="hidden">
        <!-- Header -->
        <header>
            <div class="header-content">
                <a href="#" class="logo" id="homeBtn">
                    <i class="fas fa-dove"></i> Chyrp
                </a>
                
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" placeholder="Search">
                </div>
                
                <div class="user-actions">
                    <div class="nav-icons">
                        <a href="#" id="homeIcon"><i class="fas fa-home"></i></a>
                        <a href="#" id="chatIcon"><i class="fas fa-comment"></i></a>
                        <a href="#" id="createPostBtn"><i class="fas fa-plus-square"></i></a>
                        <a href="#"><i class="fas fa-heart"></i></a>
                    </div>
                    
                    <div class="theme-selector">
                        <button class="theme-btn theme-default active" data-theme="default" title="Default Theme"></button>
                        <button class="theme-btn theme-coral" data-theme="coral" title="Coral Theme"></button>
                        <button class="theme-btn theme-night" data-theme="night" title="Night Theme"></button>
                        <button class="theme-btn theme-blossom" data-theme="blossom" title="Blossom Theme"></button>
                    </div>
                    
                    <button id="logoutBtn" class="btn btn-outline">Logout</button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <div class="container">
            <div class="main-content">
                <!-- Left Panel -->
                <div class="left-panel">
                    <div class="panel-card">
                        <h3>My Content</h3>
                        <div class="panel-item active" data-filter="all">
                            <i class="fas fa-stream"></i> All Posts
                        </div>
                        <div class="panel-item" data-filter="saved">
                            <i class="fas fa-bookmark"></i> Saved Posts
                        </div>
                        <div class="panel-item" data-filter="liked">
                            <i class="fas fa-heart"></i> Liked Posts
                        </div>
                    </div>
                    
                    <div class="panel-card">
                        <h3>Categories</h3>
                        <div class="panel-item" data-category="all">
                            <i class="fas fa-hashtag"></i> All Categories
                        </div>
                        <div class="panel-item" data-category="entertainment">
                            <i class="fas fa-film"></i> Entertainment
                        </div>
                        <div class="panel-item" data-category="sports">
                            <i class="fas fa-basketball-ball"></i> Sports
                        </div>
                        <div class="panel-item" data-category="school">
                            <i class="fas fa-graduation-cap"></i> School
                        </div>
                        <div class="panel-item" data-category="technology">
                            <i class="fas fa-laptop"></i> Technology
                        </div>
                        <div class="panel-item" data-category="travel">
                            <i class="fas fa-plane"></i> Travel
                        </div>
                        <div class="panel-item" data-category="food">
                            <i class="fas fa-utensils"></i> Food
                        </div>
                    </div>
                </div>

                <!-- Feed -->
                <div class="feed">
                    <div class="welcome-card">
                        <h2>Welcome to Chyrp!</h2>
                        <p>Share your thoughts, moments, and creativity with the world</p>
                        
                        <div class="post-options">
                            <div class="post-option-btn" data-type="blog">
                                <i class="fas fa-edit"></i>
                                <span>Blog</span>
                            </div>
                            <div class="post-option-btn" data-type="video">
                                <i class="fas fa-video"></i>
                                <span>Video</span>
                            </div>
                            <div class="post-option-btn" data-type="picture">
                                <i class="fas fa-image"></i>
                                <span>Picture</span>
                            </div>
                        </div>
                    </div>
                    
                    <div id="postsContainer">
                        <!-- Posts will be dynamically added here -->
                    </div>
                </div>

                <!-- Sidebar -->
                <div class="sidebar">
                    <div class="profile-card">
                        <div class="profile-card-avatar" id="profileAvatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="profile-card-username" id="profileUsername">@username</div>
                        <div class="profile-card-name" id="profileName">Your Name</div>
                        <div class="profile-card-caption" id="profileCaption" style="color: var(--text-light); margin-bottom: 15px;"></div>
                        
                        <div class="stats">
                            <div class="stat">
                                <div class="stat-value" id="postsCount">0</div>
                                <div class="stat-label">Posts</div>
                            </div>
                            <div class="stat">
                                <div class="stat-value">0</div>
                                <div class="stat-label">Followers</div>
                            </div>
                            <div class="stat">
                                <div class="stat-value">0</div>
                                <div class="stat-label">Following</div>
                            </div>
                        </div>
                        
                        <button class="btn btn-outline" style="width: 100%" id="editProfileBtn">Edit Profile</button>
                    </div>
                    
                    <div class="profile-card">
                        <h3>Suggestions For You</h3>
                        <p style="text-align: center; margin: 15px 0; color: var(--text-light)">No suggestions yet</p>
                        <button class="btn btn-primary" style="width: 100%">Discover More</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Profile Page -->
    <div id="profileScreen" class="profile-container hidden">
        <div class="profile-header">
            <button class="profile-back-btn" id="profileBackBtn">
                <i class="fas fa-arrow-left"></i>
            </button>
            <h2>Your Profile</h2>
        </div>
        
        <div class="profile-info">
            <div class="profile-avatar-large" id="profileAvatarLarge">
                <i class="fas fa-user"></i>
            </div>
            
            <div class="profile-details">
                <h2 id="profileFullName">Your Name</h2>
                <h3 id="profileUsernameFull">@username</h3>
                <p id="profileBioFull">This is your bio. Click edit profile to add something about yourself.</p>
                <div class="stats">
                    <div class="stat">
                        <div class="stat-value" id="profilePostsCount">0</div>
                        <div class="stat-label">Posts</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">0</div>
                        <div class="stat-label">Followers</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">0</div>
                        <div class="stat-label">Following</div>
                    </div>
                </div>
            </div>
        </div>
        
        <h3>Your Posts</h3>
        <div class="profile-posts" id="profilePostsContainer">
            <!-- User posts will be dynamically added here -->
        </div>
    </div>

    <!-- Chat Page -->
    <div id="chatScreen" class="chat-container hidden">
        <div class="chat-header">
            <button class="chat-back-btn" id="chatBackBtn">
                <i class="fas fa-arrow-left"></i>
            </button>
            <h2>Messages</h2>
        </div>
        
        <div class="chat-list">
            <div class="chat-item" data-user="emma">
                <div class="chat-item-avatar">
                    <i class="fas fa-user"></i>
                </div>
                <div class="chat-item-info">
                    <div class="chat-item-name">Emma Johnson</div>
                    <div class="chat-item-preview">Hey there! How are you doing?</div>
                </div>
                <div class="chat-item-time">2h ago</div>
            </div>
            
            <div class="chat-item" data-user="alex">
                <div class="chat-item-avatar">
                    <i class="fas fa-user"></i>
                </div>
                <div class="chat-item-info">
                    <div class="chat-item-name">Alex Parker</div>
                    <div class="chat-item-preview">Did you see the new movie?</div>
                </div>
                <div class="chat-item-time">1d ago</div>
            </div>
            
            <div class="chat-item" data-user="sarah">
                <div class="chat-item-avatar">
                    <i class="fas fa-user"></i>
                </div>
                <div class="chat-item-info">
                    <div class="chat-item-name">Sarah Williams</div>
                    <div class="chat-item-preview">Let's meet up this weekend!</div>
                </div>
                <div class="chat-item-time">3d ago</div>
            </div>
        </div>
    </div>

    <!-- Chat Room -->
    <div id="chatRoom" class="chat-room hidden">
        <div class="chat-room-header">
            <button class="chat-room-back-btn" id="chatRoomBackBtn">
                <i class="fas fa-arrow-left"></i>
            </button>
            <h2 id="chatRoomUserName">Emma Johnson</h2>
        </div>
        
        <div class="chat-messages" id="chatMessages">
            <div class="message received">
                <div class="message-content">
                    Hey there! How are you doing?
                </div>
                <div class="message-time">10:30 AM</div>
            </div>
            
            <div class="message sent">
                <div class="message-content">
                    I'm doing great! Just finished my project.
                </div>
                <div class="message-time">10:32 AM</div>
            </div>
            
            <div class="message received">
                <div class="message-content">
                    That's awesome! Can't wait to see it.
                </div>
                <div class="message-time">10:35 AM</div>
            </div>
        </div>
        
        <div class="chat-input">
            <input type="text" placeholder="Type a message..." id="chatInput">
            <button id="sendMessageBtn"><i class="fas fa-paper-plane"></i></button>
        </div>
    </div>

    <!-- Create Post Modal -->
    <div id="createPostModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Create New Post</h3>
                <button class="modal-close" id="closePostModal">&times;</button>
            </div>
            
            <div class="modal-body">
                <div class="post-type-selector">
                    <button class="post-type-btn active" data-type="blog">Blog</button>
                                        <button class="post-type-btn" data-type="video">Video</button>
                    <button class="post-type-btn" data-type="picture">Picture</button>
                </div>
                
                <form class="post-form" id="postForm">
                    <div class="form-group">
                        <label for="postTitle">Title</label>
                        <input type="text" id="postTitle" placeholder="Enter post title" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="postContent">Content</label>
                        <textarea id="postContent" placeholder="What's on your mind?" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="postCategory">Category</label>
                        <select id="postCategory" required>
                            <option value="">Select a category</option>
                            <option value="entertainment">Entertainment</option>
                            <option value="sports">Sports</option>
                            <option value="school">School</option>
                            <option value="technology">Technology</option>
                            <option value="travel">Travel</option>
                            <option value="food">Food</option>
                        </select>
                    </div>
                    
                    <div class="form-group" id="mediaUploadGroup">
                        <label for="postMedia">Add Media (optional)</label>
                        <div class="file-upload" id="mediaUpload">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>Click to upload or drag and drop</p>
                            <input type="file" id="postMedia" style="display: none;" accept="image/*,video/*">
                            <img id="mediaPreview" src="" alt="Preview">
                        </div>
                    </div>
                </form>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancelPost">Cancel</button>
                <button class="btn btn-primary" id="submitPost">Publish</button>
            </div>
        </div>
    </div>

    <!-- Edit Profile Modal -->
    <div id="editProfileModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Profile</h3>
                <button class="modal-close" id="closeProfileModal">&times;</button>
            </div>
            
            <div class="modal-body">
                <div class="profile-pic-upload">
                    <div class="avatar-preview" id="avatarPreview">
                        <i class="fas fa-user"></i>
                    </div>
                    <button class="btn btn-outline" id="changeAvatarBtn">Change Profile Picture</button>
                    <input type="file" id="avatarUpload" style="display: none;">
                </div>
                
                <form class="profile-edit-form" id="profileEditForm">
                    <div class="form-group">
                        <label for="profileNameInput">Full Name</label>
                        <input type="text" id="profileNameInput" placeholder="Enter your full name">
                    </div>
                    
                    <div class="form-group">
                        <label for="profileUsernameInput">Username</label>
                        <input type="text" id="profileUsernameInput" placeholder="Enter your username">
                    </div>
                    
                    <div class="form-group">
                        <label for="profileBioInput">Bio</label>
                        <textarea id="profileBioInput" placeholder="Tell people about yourself"></textarea>
                    </div>
                </form>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancelProfileEdit">Cancel</button>
                <button class="btn btn-primary" id="saveProfile">Save Changes</button>
            </div>
        </div>
    </div>

<!-- The rest of your HTML remains the same until the script section -->

<script>
// DOM Elements
const authScreen = document.getElementById('authScreen');
const registerScreen = document.getElementById('registerScreen');
const appScreen = document.getElementById('appScreen');
const profileScreen = document.getElementById('profileScreen');
const chatScreen = document.getElementById('chatScreen');
const chatRoom = document.getElementById('chatRoom');
const createPostModal = document.getElementById('createPostModal');
const editProfileModal = document.getElementById('editProfileModal');

// Auth elements
const showRegisterBtn = document.getElementById('showRegister');
const showLoginBtn = document.getElementById('showLogin');
const loginForm = document.getElementById('loginForm');
const registerForm = document.getElementById('registerForm');
const logoutBtn = document.getElementById('logoutBtn');

// Navigation elements
const homeBtn = document.getElementById('homeBtn');
const homeIcon = document.getElementById('homeIcon');
const chatIcon = document.getElementById('chatIcon');
const createPostBtn = document.getElementById('createPostBtn');
const profileAvatar = document.getElementById('profileAvatar');
const profileBackBtn = document.getElementById('profileBackBtn');
const chatBackBtn = document.getElementById('chatBackBtn');
const chatRoomBackBtn = document.getElementById('chatRoomBackBtn');

// Post elements
const closePostModal = document.getElementById('closePostModal');
const cancelPost = document.getElementById('cancelPost');
const submitPost = document.getElementById('submitPost');
const postForm = document.getElementById('postForm');
const postsContainer = document.getElementById('postsContainer');
const profilePostsContainer = document.getElementById('profilePostsContainer');
const mediaUpload = document.getElementById('mediaUpload');
const postMedia = document.getElementById('postMedia');
const mediaPreview = document.getElementById('mediaPreview');

// Profile elements
const editProfileBtn = document.getElementById('editProfileBtn');
const closeProfileModal = document.getElementById('closeProfileModal');
const cancelProfileEdit = document.getElementById('cancelProfileEdit');
const saveProfile = document.getElementById('saveProfile');
const profileEditForm = document.getElementById('profileEditForm');
const changeAvatarBtn = document.getElementById('changeAvatarBtn');
const avatarUpload = document.getElementById('avatarUpload');

// Chat elements
const chatItems = document.querySelectorAll('.chat-item');
const chatInput = document.getElementById('chatInput');
const sendMessageBtn = document.getElementById('sendMessageBtn');
const chatMessages = document.getElementById('chatMessages');

// Theme elements
const themeButtons = document.querySelectorAll('.theme-btn');

// Panel elements
const panelItems = document.querySelectorAll('.panel-item');

// API base URL - ADD THIS
const API_BASE = 'http://localhost:5000/api';

// Helper function for API calls - ADD THIS
async function apiCall(endpoint, options = {}) {
  const token = localStorage.getItem('token');
  const defaultOptions = {
    headers: {
      'Content-Type': 'application/json',
      ...(token && { 'Authorization': `Bearer ${token}` }),
      ...options.headers,
    },
  };

  try {
    const response = await fetch(`${API_BASE}${endpoint}`, {
      ...defaultOptions,
      ...options,
      body: options.body ? JSON.stringify(options.body) : undefined,
    });

    const data = await response.json();
    
    if (!response.ok) {
      throw new Error(data.message || 'API request failed');
    }
    
    return data;
  } catch (error) {
    console.error('API call error:', error);
    throw error;
  }
}

// User data - UPDATE THIS
let currentUser = null;
let allPosts = [];
let likedPosts = [];
let savedPosts = [];
let currentFilter = 'all';
let currentCategory = 'all';

// Initialize the app - UPDATE THIS
async function initApp() {
  const token = localStorage.getItem('token');
  const savedUser = localStorage.getItem('currentUser');
  
  if (token && savedUser) {
    try {
      // Verify token is still valid
      const data = await apiCall('/auth/me');
      currentUser = data.user;
      showApp();
      loadPosts();
      updateProfileInfo();
    } catch (error) {
      // Token is invalid, clear storage
      localStorage.removeItem('token');
      localStorage.removeItem('currentUser');
      console.error('Token validation failed:', error);
    }
  }
  
  setupEventListeners();
}

// Set up event listeners
function setupEventListeners() {
  // Auth event listeners
  showRegisterBtn.addEventListener('click', showRegister);
  showLoginBtn.addEventListener('click', showLogin);
  loginForm.addEventListener('submit', handleLogin);
  registerForm.addEventListener('submit', handleRegister);
  logoutBtn.addEventListener('click', handleLogout);
  
  // Navigation event listeners
  homeBtn.addEventListener('click', showApp);
  homeIcon.addEventListener('click', showApp);
  chatIcon.addEventListener('click', showChatScreen);
  createPostBtn.addEventListener('click', showCreatePostModal);
  profileAvatar.addEventListener('click', showProfileScreen);
  profileBackBtn.addEventListener('click', showApp);
  chatBackBtn.addEventListener('click', showApp);
  chatRoomBackBtn.addEventListener('click', showChatScreen);
  
  // Post event listeners
  closePostModal.addEventListener('click', hideCreatePostModal);
  cancelPost.addEventListener('click', hideCreatePostModal);
  submitPost.addEventListener('click', handlePostSubmit);
  mediaUpload.addEventListener('click', () => postMedia.click());
  postMedia.addEventListener('change', handleMediaUpload);
  
  // Profile event listeners
  editProfileBtn.addEventListener('click', showEditProfileModal);
  closeProfileModal.addEventListener('click', hideEditProfileModal);
  cancelProfileEdit.addEventListener('click', hideEditProfileModal);
  saveProfile.addEventListener('click', handleProfileSave);
  changeAvatarBtn.addEventListener('click', () => avatarUpload.click());
  avatarUpload.addEventListener('change', handleAvatarUpload);
  
  // Chat event listeners
  chatItems.forEach(item => {
    item.addEventListener('click', () => {
      const userName = item.getAttribute('data-user');
      showChatRoom(userName);
    });
  });
  sendMessageBtn.addEventListener('click', handleSendMessage);
  chatInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
      handleSendMessage();
    }
  });
  
  // Theme event listeners
  themeButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      const theme = btn.getAttribute('data-theme');
      changeTheme(theme);
      
      // Update active state
      themeButtons.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
    });
  });
  
  // Post option buttons
  document.querySelectorAll('.post-option-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const type = btn.getAttribute('data-type');
      showCreatePostModal(type);
    });
  });
  
  // Panel item listeners
  panelItems.forEach(item => {
    item.addEventListener('click', () => {
      // Remove active class from all items
      panelItems.forEach(i => i.classList.remove('active'));
      
      // Add active class to clicked item
      item.classList.add('active');
      
      // Handle filter items
      if (item.hasAttribute('data-filter')) {
        currentFilter = item.getAttribute('data-filter');
        loadPosts();
      }
      
      // Handle category items
      if (item.hasAttribute('data-category')) {
        currentCategory = item.getAttribute('data-category');
        loadPosts();
      }
    });
  });
  
  // Post type selector
  document.querySelectorAll('.post-type-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.post-type-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
    });
  });
}

// Auth functions
function showRegister(e) {
  e.preventDefault();
  authScreen.classList.add('hidden');
  registerScreen.classList.remove('hidden');
}

function showLogin(e) {
  e.preventDefault();
  registerScreen.classList.add('hidden');
  authScreen.classList.remove('hidden');
}

async function handleLogin(e) {
  e.preventDefault();
  const email = document.getElementById('email').value;
  const password = document.getElementById('password').value;
  
  try {
    const data = await apiCall('/auth/login', {
      method: 'POST',
      body: { email, password }
    });
    
    localStorage.setItem('token', data.token);
    localStorage.setItem('currentUser', JSON.stringify(data.user));
    currentUser = data.user;
    showApp();
    loadPosts();
    updateProfileInfo();
  } catch (error) {
    alert(error.message || 'Login failed');
  }
}

async function handleRegister(e) {
  e.preventDefault();
  const name = document.getElementById('reg-name').value;
  const username = document.getElementById('reg-username').value;
  const email = document.getElementById('reg-email').value;
  const password = document.getElementById('reg-password').value;
  
  try {
    const data = await apiCall('/auth/register', {
      method: 'POST',
      body: { name, username, email, password }
    });
    
    localStorage.setItem('token', data.token);
    localStorage.setItem('currentUser', JSON.stringify(data.user));
    currentUser = data.user;
    showApp();
    updateProfileInfo();
    
    // Clear form
    document.getElementById('reg-name').value = '';
    document.getElementById('reg-username').value = '';
    document.getElementById('reg-email').value = '';
    document.getElementById('reg-password').value = '';
  } catch (error) {
    alert(error.message || 'Registration failed');
  }
}

function handleLogout() {
  currentUser = null;
  localStorage.removeItem('currentUser');
  localStorage.removeItem('token');
  hideAllScreens();
  authScreen.classList.remove('hidden');
}

// Navigation functions
function showApp() {
  hideAllScreens();
  appScreen.classList.remove('hidden');
}

function showProfileScreen() {
  hideAllScreens();
  profileScreen.classList.remove('hidden');
  loadProfilePosts();
  updateProfileInfo();
}

function showChatScreen() {
  hideAllScreens();
  chatScreen.classList.remove('hidden');
}

function showChatRoom(userName) {
  hideAllScreens();
  chatRoom.classList.remove('hidden');
  
  // Set the chat room user name
  const nameMap = {
    'emma': 'Emma Johnson',
    'alex': 'Alex Parker',
    'sarah': 'Sarah Williams'
  };
  
  document.getElementById('chatRoomUserName').textContent = nameMap[userName];
}

function hideAllScreens() {
  authScreen.classList.add('hidden');
  registerScreen.classList.add('hidden');
  appScreen.classList.add('hidden');
  profileScreen.classList.add('hidden');
  chatScreen.classList.add('hidden');
  chatRoom.classList.add('hidden');
  createPostModal.style.display = 'none';
  editProfileModal.style.display = 'none';
}

// Post functions
function showCreatePostModal(type = 'blog') {
  createPostModal.style.display = 'flex';
  
  // Set active post type
  document.querySelectorAll('.post-type-btn').forEach(btn => {
    if (btn.getAttribute('data-type') === type) {
      btn.classList.add('active');
    } else {
      btn.classList.remove('active');
    }
  });
  
  // Reset form
  postForm.reset();
  mediaPreview.style.display = 'none';
  mediaPreview.src = '';
}

function hideCreatePostModal() {
  createPostModal.style.display = 'none';
  postForm.reset();
  mediaPreview.style.display = 'none';
  mediaPreview.src = '';
}

function handleMediaUpload(e) {
  const file = e.target.files[0];
  if (!file) return;
  
  const reader = new FileReader();
  reader.onload = function(event) {
    mediaPreview.src = event.target.result;
    mediaPreview.style.display = 'block';
  };
  
  reader.readAsDataURL(file);
}

async function handlePostSubmit() {
  const title = document.getElementById('postTitle').value;
  const content = document.getElementById('postContent').value;
  const category = document.getElementById('postCategory').value;
  const type = document.querySelector('.post-type-btn.active').getAttribute('data-type');
  const media = mediaPreview.src || null;
  
  try {
    const data = await apiCall('/posts', {
      method: 'POST',
      body: { title, content, type, category, media }
    });
    
    addPostToFeed(data.post);
    hideCreatePostModal();
    updatePostCount();
  } catch (error) {
    alert(error.message || 'Failed to create post');
  }
}

async function loadPosts() {
  try {
    const data = await apiCall(`/posts?filter=${currentFilter}&category=${currentCategory}`);
    displayPosts(data.posts);
  } catch (error) {
    console.error('Failed to load posts:', error);
    postsContainer.innerHTML = `
      <div class="post">
        <div class="post-content">
          <p style="text-align: center; color: var(--text-light); padding: 30px;">
            Failed to load posts. Please try again.
          </p>
        </div>
      </div>
    `;
  }
}

function displayPosts(posts) {
  postsContainer.innerHTML = '';
  allPosts = posts;
  
  if (posts.length === 0) {
    postsContainer.innerHTML = `
      <div class="post">
        <div class="post-content">
          <p style="text-align: center; color: var(--text-light); padding: 30px;">
            No posts found. ${currentFilter !== 'all' || currentCategory !== 'all' ? 'Try changing your filters.' : 'Create your first post!'}
          </p>
        </div>
      </div>
    `;
    return;
  }
  
  posts.forEach(post => {
    addPostToFeed(post);
  });
}

function addPostToFeed(post) {
  const postElement = document.createElement('div');
  postElement.className = 'post';
  postElement.dataset.id = post._id || post.id;
  
  const isLiked = post.likes && post.likes.includes(currentUser.id);
  const isSaved = post.savedBy && post.savedBy.includes(currentUser.id);
  
  postElement.innerHTML = `
    <div class="post-header">
      <div class="post-avatar">
        ${post.author.avatar ? `<img src="${post.author.avatar}" alt="${post.author.name}">` : '<i class="fas fa-user"></i>'}
      </div>
      <div>
        <div class="post-author">${post.author.name}</div>
        <div class="post-time">${formatDate(post.createdAt || post.timestamp)}</div>
      </div>
    </div>
    <div class="post-content">
      <span class="post-category">${post.category}</span>
      <h3 class="post-title">${post.title}</h3>
      <p class="post-text">${post.content}</p>
      ${post.media ? `<img src="${post.media}" class="post-image" alt="Post media">` : ''}
    </div>
    <div class="post-actions">
      <div class="post-action ${isLiked ? 'active' : ''}" data-action="like">
        <i class="${isLiked ? 'fas' : 'far'} fa-heart"></i>
        <span>${post.likes ? post.likes.length : 0}</span>
      </div>
      <div class="post-action" data-action="comment">
        <i class="far fa-comment"></i>
        <span>${post.comments ? post.comments.length : 0}</span>
      </div>
      <div class="post-action ${isSaved ? 'active' : ''}" data-action="save">
        <i class="${isSaved ? 'fas' : 'far'} fa-bookmark"></i>
      </div>
    </div>
  `;
  
  // Add event listeners to action buttons
  const likeBtn = postElement.querySelector('[data-action="like"]');
  const saveBtn = postElement.querySelector('[data-action="save"]');
  
  likeBtn.addEventListener('click', () => handleLikePost(post._id || post.id));
  saveBtn.addEventListener('click', () => handleSavePost(post._id || post.id));
  
  postsContainer.appendChild(postElement);
}

async function handleLikePost(postId) {
  try {
    const data = await apiCall(`/posts/${postId}/like`, {
      method: 'POST'
    });
    
    // Update the post in the UI
    const postElement = document.querySelector(`.post[data-id="${postId}"]`);
    if (postElement) {
      const likeBtn = postElement.querySelector('[data-action="like"]');
      const likeCount = postElement.querySelector('[data-action="like"] span');
      
      likeBtn.classList.toggle('active');
      likeCount.textContent = data.likes;
      
      const icon = likeBtn.querySelector('i');
      icon.className = likeBtn.classList.contains('active') ? 'fas fa-heart' : 'far fa-heart';
    }
  } catch (error) {
    console.error('Failed to like post:', error);
  }
}

async function handleSavePost(postId) {
  try {
    const data = await apiCall(`/posts/${postId}/save`, {
      method: 'POST'
    });
    
    // Update the post in the UI
    const postElement = document.querySelector(`.post[data-id="${postId}"]`);
    if (postElement) {
      const saveBtn = postElement.querySelector('[data-action="save"]');
      saveBtn.classList.toggle('active');
      
      const icon = saveBtn.querySelector('i');
      icon.className = saveBtn.classList.contains('active') ? 'fas fa-bookmark' : 'far fa-bookmark';
    }
  } catch (error) {
    console.error('Failed to save post:', error);
  }
}

async function loadProfilePosts() {
  try {
    const data = await apiCall(`/users/${currentUser.username}`);
    displayProfilePosts(data.posts);
  } catch (error) {
    console.error('Failed to load profile posts:', error);
    profilePostsContainer.innerHTML = `
      <div style="grid-column: 1 / -1; text-align: center; padding: 30px; color: var(--text-light);">
        Failed to load posts. Please try again.
      </div>
    `;
  }
}

function displayProfilePosts(posts) {
  profilePostsContainer.innerHTML = '';
  
  if (posts.length === 0) {
    profilePostsContainer.innerHTML = `
      <div style="grid-column: 1 / -1; text-align: center; padding: 30px; color: var(--text-light);">
        You haven't created any posts yet.
      </div>
    `;
    return;
  }
  
  posts.forEach(post => {
    const postElement = document.createElement('div');
    postElement.className = 'profile-post';
    postElement.innerHTML = `
      ${post.media ? `<img src="${post.media}" alt="Post image">` : `<div style="height: 250px; background: var(--accent); display: flex; align-items: center; justify-content: center; color: white;"><i class="fas fa-${post.type === 'blog' ? 'edit' : post.type === 'video' ? 'video' : 'image'} fa-3x"></i></div>`}
      <div class="profile-post-content">
        <span class="post-category">${post.category}</span>
        <h4 class="profile-post-title">${post.title}</h4>
        <p class="profile-post-text">${post.content}</p>
        <div class="profile-post-date">${formatDate(post.createdAt || post.timestamp)}</div>
      </div>
    `;
    
    profilePostsContainer.appendChild(postElement);
  });
}

// Profile functions
function showEditProfileModal() {
  // Fill form with current data
  document.getElementById('profileNameInput').value = currentUser.name || '';
  document.getElementById('profileUsernameInput').value = currentUser.username || '';
  document.getElementById('profileBioInput').value = currentUser.bio || '';
  
  // Set avatar preview
  const avatarPreview = document.getElementById('avatarPreview');
  if (currentUser.avatar) {
    avatarPreview.innerHTML = `<img src="${currentUser.avatar}" alt="Profile avatar">`;
  } else {
    avatarPreview.innerHTML = '<i class="fas fa-user"></i>';
  }
  
  editProfileModal.style.display = 'flex';
}

function hideEditProfileModal() {
  editProfileModal.style.display = 'none';
}

async function handleProfileSave() {
  const name = document.getElementById('profileNameInput').value;
  const username = document.getElementById('profileUsernameInput').value;
  const bio = document.getElementById('profileBioInput').value;
  
  try {
    const data = await apiCall('/users/profile', {
      method: 'PUT',
      body: { name, username, bio }
    });
    
    currentUser = data.user;
    localStorage.setItem('currentUser', JSON.stringify(data.user));
    updateProfileInfo();
    hideEditProfileModal();
  } catch (error) {
    alert(error.message || 'Failed to update profile');
  }
}

async function handleAvatarUpload(e) {
  const file = e.target.files[0];
  if (!file) return;
  
  const formData = new FormData();
  formData.append('avatar', file);
  
  try {
    const response = await fetch(`${API_BASE}/upload/avatar`, {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${localStorage.getItem('token')}`
      },
      body: formData
    });
    
    const data = await response.json();
    
    if (!response.ok) {
      throw new Error(data.message || 'Upload failed');
    }
    
    // Update current user with new avatar
    currentUser.avatar = data.filePath;
    localStorage.setItem('currentUser', JSON.stringify(currentUser));
    
    // Update avatar preview
    const avatarPreview = document.getElementById('avatarPreview');
    avatarPreview.innerHTML = `<img src="${data.filePath}" alt="Profile avatar">`;
    
    // Update UI
    updateProfileInfo();
  } catch (error) {
    alert(error.message || 'Failed to upload avatar');
  }
}

async function updateProfileInfo() {
  try {
    const data = await apiCall(`/users/${currentUser.username}`);
    
    // Update UI with user data
    document.getElementById('profileUsername').textContent = '@' + data.user.username;
    document.getElementById('profileName').textContent = data.user.name;
    document.getElementById('profileCaption').textContent = data.user.bio || '';
    
    // Update profile page
    document.getElementById('profileFullName').textContent = data.user.name;
    document.getElementById('profileUsernameFull').textContent = '@' + data.user.username;
    document.getElementById('profileBioFull').textContent = data.user.bio || 'This is your bio. Click edit profile to add something about yourself.';
    
    // Update avatar if available
    if (data.user.avatar) {
      document.getElementById('profileAvatar').innerHTML = `<img src="${data.user.avatar}" alt="Profile avatar">`;
      document.getElementById('profileAvatarLarge').innerHTML = `<img src="${data.user.avatar}" alt="Profile avatar">`;
    }
    
    // Update post count
    document.getElementById('postsCount').textContent = data.posts.length;
    document.getElementById('profilePostsCount').textContent = data.posts.length;
  } catch (error) {
    console.error('Failed to update profile:', error);
  }
}

async function updatePostCount() {
  try {
    const data = await apiCall(`/users/${currentUser.username}`);
    document.getElementById('postsCount').textContent = data.posts.length;
    document.getElementById('profilePostsCount').textContent = data.posts.length;
  } catch (error) {
    console.error('Failed to update post count:', error);
  }
}

// Chat functions
function handleSendMessage() {
  const message = chatInput.value.trim();
  if (!message) return;
  
  const messageElement = document.createElement('div');
  messageElement.className = 'message sent';
  messageElement.innerHTML = `
    <div class="message-content">${message}</div>
    <div class="message-time">${formatTime(new Date())}</div>
  `;
  
  chatMessages.appendChild(messageElement);
  chatInput.value = '';
  
  // Scroll to bottom
  chatMessages.scrollTop = chatMessages.scrollHeight;
  
  // Simulate reply after a delay
  setTimeout(() => {
    const replies = [
      "That's interesting!",
      "Tell me more about that.",
      "I see what you mean.",
      "I agree with you.",
      "Thanks for sharing!"
    ];
    
    const randomReply = replies[Math.floor(Math.random() * replies.length)];
    
    const replyElement = document.createElement('div');
    replyElement.className = 'message received';
    replyElement.innerHTML = `
      <div class="message-content">${randomReply}</div>
      <div class="message-time">${formatTime(new Date())}</div>
    `;
    
    chatMessages.appendChild(replyElement);
    
    // Scroll to bottom
    chatMessages.scrollTop = chatMessages.scrollHeight;
  }, 1000);
}

// Theme functions
function changeTheme(theme) {
  document.body.className = '';
  document.body.classList.add(`theme-${theme}`);
}

// Utility functions
function formatDate(dateString) {
  const date = new Date(dateString);
  const now = new Date();
  const diff = now - date;
  
  // Less than a minute ago
  if (diff < 60000) {
    return 'Just now';
  }
  
  // Less than an hour ago
  if (diff < 3600000) {
    const minutes = Math.floor(diff / 60000);
    return `${minutes} minute${minutes !== 1 ? 's' : ''} ago`;
  }
  
  // Less than a day ago
  if (diff < 86400000) {
    const hours = Math.floor(diff / 3600000);
    return `${hours} hour${hours !== 1 ? 's' : ''} ago`;
  }
  
  // More than a day ago
  const days = Math.floor(diff / 86400000);
  if (days < 7) {
    return `${days} day${days !== 1 ? 's' : ''} ago`;
  }
  
  // More than a week ago
  return date.toLocaleDateString();
}

function formatTime(date) {
  return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
}

// Initialize the app when the DOM is loaded
document.addEventListener('DOMContentLoaded', initApp);
</script>
</body>
</html>